<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
  <head>
    <title>GPA Calculator</title>
    <meta name="description" content="Calculate GPA on a 4.33 scale" />
    <script>
      // Author: David Faden, dfaden (AT) gmail (DOT) com
      // Last major update: September 6, 2004

      var Invalid = -1000;

      // Insert the input fields for a new class
      // into the table.
      function addNewClass() {
        var tbody = document.getElementById("classes_tbody");
        var newTr = document.createElement("tr");
        for (var i = 0; i < 3; ++i) {
          var td = document.createElement("td");
          var input = document.createElement("input");
          input.size = "15";
          if (i != 0) {
            input.setAttribute("onchange", "updateCreditsGpa()");
          }
          td.appendChild(input);
          newTr.appendChild(td);
        }
        tbody.appendChild(newTr);
      }

      // Update the credits and GPA fields.
      function updateCreditsGpa() {
        if (document.getElementById) {
          var tbody = document.getElementById("classes_tbody");
          var elements = tbody.getElementsByTagName("input");
          updateCreditsGpaWith(elements);
        } else {
          updateCreditsGpaWith(document.classes.elements);
        }
      }

      // Convert the given float to a string of the closest
      // float with two or fewer places after the decimal.
      function formatDecimal(aFloat) {
        var digits = "" + Math.round(100 * aFloat);
        var length = digits.length;
        if (length < 3) {
          return "0." + digits;
        } else {
          var dp = length - 2;
          return digits.substring(0, dp) + "." + digits.substring(dp, length);
        }
      }

      // Return the char of aString at index.
      // If index is invalid, the results are undefined.
      function charAt(aString, index) {
        var length = aString.length;
        return aString.substring(index, index + 1);
      }

      // Convert the given string to a float or return Invalid
      // if the given input is not recognized as credit hours.
      function toFloatOrInvalid(input) {
        var length = input.length;
        if (length == 0) {
          return Invalid;
        }
        var first = charAt(input, 0);
        if (first == "0") {
          if (length == 1) {
            return 0.0;
          } else if (charAt(input, 1) != ".") {
            return Invalid;
          }
        } else if ("123456789".indexOf(first) == -1) {
          return Invalid;
        }
        var i = 1;
        for (; i < length; ++i) {
          var m = ".0123456789".indexOf(charAt(input, i));
          if (m == -1) {
            return Invalid;
          } else if (m == 0) {
            break;
          }
        }
        for (var j = i + 1; j < length; j++) {
          if ("0123456789".indexOf(charAt(input, j)) == -1) {
            return Invalid;
          }
        }
        return parseFloat(input);
      }

      function updateCreditsGpaWith(elements) {
        var totalGradedCredits = 0;
        var totalUngradedCredits = 0;
        var totalPoints = 0;

        var haveAtLeastOneGrade = false;

        var length = elements.length;
        for (var i = 0; i < length; i += 3) {
          var letter = elements[i + 2].value.toUpperCase();
          if (letter == "X") {
            continue;
          }

          var creditsString = elements[i + 1].value;
          if (creditsString == "") {
            continue;
          }

          var credits = toFloatOrInvalid(creditsString);
          if (credits == Invalid) {
            alert('Not a number: "' + creditsString + '"');
            return;
          }

          if (letter == "P" || letter == "T" || letter == "N") {
            totalUngradedCredits += credits;
            continue;
          } else {
            totalGradedCredits += credits;
          }

          if (letter == "") {
            continue;
          }
          var points = letterToPoints(letter);
          if (points == Invalid) {
            alert('Unrecognized letter grade: "' + letter + '"');
            return;
          }
          haveAtLeastOneGrade = true;

          totalPoints += credits * points;
        }
        document.results.total_credits.value =
          totalGradedCredits + totalUngradedCredits;
        if (haveAtLeastOneGrade && totalGradedCredits > 0) {
          document.results.gpa.value = formatDecimal(
            totalPoints / totalGradedCredits,
          );
        } else {
          document.results.gpa.value = "";
        }
      }

      //Return the points corresponding to the given letter
      //grade or Invalid if the input is invalid. The grade
      //is expected to be capitalized: A, B, etc.
      function letterToPoints(grade) {
        if ("A+" == grade) {
          return 4.33;
        } else if ("A" == grade) {
          return 4.0;
        } else if ("A-" == grade) {
          return 3.67;
        } else if ("B+" == grade) {
          return 3.33;
        } else if ("B" == grade) {
          return 3.0;
        } else if ("B-" == grade) {
          return 2.67;
        } else if ("C+" == grade) {
          return 2.33;
        } else if ("C" == grade) {
          return 2.0;
        } else if ("C-" == grade) {
          return 1.67;
        } else if ("D+" == grade) {
          return 1.33;
        } else if ("D" == grade) {
          return 1.0;
        } else if ("D-" == grade) {
          return 0.67;
        } else if ("F" == grade) {
          return 0.0;
        } else {
          //XXX! Should we throw an exception here?
          return Invalid;
        }
      }
    </script>
  </head>
  <body>
    <form
      name="classes"
      method="post"
      onSubmit="updateCreditsGpa(); return false"
    >
      <table border="0" width="468">
        <tbody id="classes_tbody">
          <tr>
            <th align="left">Class</th>
            <th align="left">Credits</th>
            <th align="left">Letter Grade</th>
          </tr>
          <tr>
            <td><input size="15" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
          </tr>
          <tr>
            <td><input size="15" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
          </tr>
          <tr>
            <td><input size="15" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
          </tr>
          <tr>
            <td><input size="15" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
          </tr>
          <tr>
            <td><input size="15" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
          </tr>
          <tr>
            <td><input size="15" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
          </tr>
          <tr>
            <td><input size="15" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
          </tr>
          <tr>
            <td><input size="15" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
          </tr>
          <tr>
            <td><input size="15" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
          </tr>
          <tr>
            <td><input size="15" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
          </tr>
          <tr>
            <td><input size="15" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
          </tr>
          <tr>
            <td><input size="15" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
            <td><input size="15" onChange="updateCreditsGpa()" /></td>
          </tr>
        </tbody>
      </table>
    </form>
    <br />
    <script language="JavaScript">
      if (document.createElement) {
        document.writeln(
          '<form><input type="button" value="Add Class" onClick="addNewClass()"></form><br>',
        );
      }
    </script>
    <form name="results" method="post" onSubmit="return false">
      <table border="0" width="468">
        <tr>
          <td>Total Credits: <input name="total_credits" size="10" /></td>
          <td>GPA: <input name="gpa" size="10" /></td>
          <td>
            <input
              type="button"
              value="Calculate"
              onClick="updateCreditsGpa()"
            />
          </td>
        </tr>
      </table>
    </form>
    <br />
    <table border="0">
      <tr>
        <td>A+</td>
        <td>4.33</td>
      </tr>
      <tr>
        <td>A</td>
        <td>4.0</td>
      </tr>
      <tr>
        <td>A-</td>
        <td>3.67</td>
      </tr>
      <tr>
        <td>B+</td>
        <td>3.33</td>
      </tr>
      <tr>
        <td>B</td>
        <td>3.0</td>
      </tr>
      <tr>
        <td>B-</td>
        <td>2.67</td>
      </tr>
      <tr>
        <td>C+</td>
        <td>2.33</td>
      </tr>
      <tr>
        <td>C</td>
        <td>2.0</td>
      </tr>
      <tr>
        <td>C-</td>
        <td>1.67</td>
      </tr>
      <tr>
        <td>D+</td>
        <td>1.33</td>
      </tr>
      <tr>
        <td>D</td>
        <td>1.0</td>
      </tr>
      <tr>
        <td>D-</td>
        <td>0.67</td>
      </tr>
      <tr>
        <td>F</td>
        <td>0.0</td>
      </tr>
      <tr>
        <td>X</td>
        <td>Drop</td>
      </tr>
      <tr>
        <td>P</td>
        <td>Pass</td>
      </tr>
      <tr>
        <td>N</td>
        <td>No Grade Available</td>
      </tr>
      <tr>
        <td>T</td>
        <td>Test Out</td>
      </tr>
    </table>
    <p>
      <a href="http://revfad.com/">Reverse Fad Productions</a>
    </p>
  </body>
</html>
